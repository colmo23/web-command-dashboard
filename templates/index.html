<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ the_title }}</title>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/static/css/main.css" />
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

    <script type="text/javascript">
        function poll(colId, intervalMs) {
            function fetch() {
                $.getJSON("ajax/get-column/" + colId, function(data) {
                    $("#column" + colId)
                        .text(data.text)
                        .closest('.terminal-window')
                        .toggleClass('terminal-error', data.is_error);
                });
            }
            fetch();
            setInterval(fetch, intervalMs);
        }

        $(function() {
            var zTop = 100;
            $('.terminal-window')
                .draggable({ handle: '.terminal-titlebar' })
                .resizable({ handles: 'all', minWidth: 250, minHeight: 150 })
                .on('mousedown', function() {
                    $(this).css('z-index', ++zTop);
                });

            {% for cmd in commands %}
            poll({{ loop.index0 }}, {{ cmd.interval * 1000 }});
            {% endfor %}
        });
    </script>
  </head>
  <body>
    {% for cmd in commands %}
    <div class="terminal-window" style="left:{{ (loop.index0 % 2) * 510 + 10 }}px; top:{{ (loop.index0 // 2) * 310 + 10 }}px;">
      <div class="terminal-titlebar">{{ cmd.title }}</div>
      <div class="terminal-body">
        <pre id="column{{ loop.index0 }}"></pre>
      </div>
    </div>
    {% endfor %}
  </body>
</html>
